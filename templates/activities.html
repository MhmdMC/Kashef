<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>جميع النشاطات</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { text-align: right; }
        .collapse-card {
            background: #f8f9fa;
            padding: 1rem;
            margin: 0.25rem 0 0.5rem 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .collapse-card p {
            margin: 0.25rem 0;
        }
        .collapse-card .paragraphs {
            white-space: pre-wrap;
        }
        .table td, .table th {
            vertical-align: middle;
        }
    </style>
</head>
<body class="p-4">
<div class="container">
    <h1 class="mb-4">جميع النشاطات</h1>

    <!-- Date Filter Buttons -->
    <div class="mb-3">
        <a href="{{ url_for('activities', start=three_days_start, end=today) }}" class="btn btn-primary me-2">آخر 3 أيام</a>
        <a href="{{ url_for('activities', start=seven_days_start, end=today) }}" class="btn btn-secondary">آخر 7 أيام</a>
        <a href="{{ url_for('activities', start=thirty_days_start, end=today) }}" class="btn btn-info me-2">آخر 30 يوم</a>
        <!-- <input type="number" id="customDays" class="form-control d-inline-block" style="width:100px;" min="1" placeholder="عدد الأيام">-->
        <!-- <button class="btn btn-success" onclick="filterDays()">عرض</button>-->
    </div>

    <!-- Activities Table -->
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>التاريخ</th>
                <th>المجموعة</th>
                <th>نوع النشاط</th>
                <th>تعديل</th>
                <th>حذف</th> <!-- New column header -->
                <th>عرض</th>
            </tr>
            </thead>
            <tbody>
            {% for act in activities %}
            <tr>
                <td>{{ act[0] }}</td>
                <td>{{ act[1] }}</td>
                <td>{{ act[2] }}</td>
                <td>{{ act[3] }}</td>
                <td>
                    <a href="{{ url_for('edit_activity', activity_id=act[0]) }}" class="btn btn-sm btn-warning">تعديل</a>
                </td>
                <td>
                    <form action="{{ url_for('delete_activity', activity_id=act[0]) }}" method="POST" style="display:inline-block;" onsubmit="return confirm('هل أنت متأكد من حذف هذا النشاط؟');">
                        <button type="submit" class="btn btn-sm btn-danger">حذف</button>
                    </form>
                </td>
                <td>
                    <button class="btn btn-sm btn-info" type="button" data-bs-toggle="collapse" data-bs-target="#details{{ act[0] }}" aria-expanded="false" aria-controls="details{{ act[0] }}">
                        عرض
                    </button>
                </td>
            </tr>

            <tr>
                <td colspan="6" class="p-0">
                    <div class="collapse" id="details{{ act[0] }}">
                        <div class="collapse-card">
                            <p><strong>المكان:</strong> {{ act[6] }}</p>
                            <p><strong>الوقت:</strong> {{ act[4] }}</p>
                            <p><strong>القادة:</strong> {{ act[7] }}, <strong>الجوالة:</strong> {{ act[8] }}, <strong>الكشافة:</strong> {{ act[9] }}, <strong>الأشبال:</strong> {{ act[10] }}, <strong>البراعم:</strong> {{ act[11] }}, <strong>غير الكشافة:</strong> {{ act[12] }}</p>
                            <p><strong>المناسبة:</strong> {{ act[5] }}</p>
                            <p><strong>الفقرات:</strong><br><span class="paragraphs">{{ act[13] }}</span></p>
                            <p><strong>التكلفة:</strong> {{ act[14] }}</p>
                            <p><strong>تاريخ الإنشاء:</strong> {{ act[15] }}</p>
                            <p><strong>تاريخ التعديل:</strong> {{ act[16] }}</p>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Only allow one collapse open at a time
    const collapseElements = document.querySelectorAll('.collapse');
    collapseElements.forEach(el => {
        el.addEventListener('show.bs.collapse', () => {
            collapseElements.forEach(other => {
                if (other !== el) {
                    bootstrap.Collapse.getInstance(other)?.hide();
                }
            });
        });
    });

//function filterDays() {
//    const days = document.getElementById('customDays').value;
//    if(days && days > 0) {
//        // Redirect to /activities with start date = today - days
//        const today = new Date();
//        const startDate = new Date(today);
//        startDate.setDate(today.getDate() - days);
//        
//        const yyyy = startDate.getFullYear();
//        const mm = String(startDate.getMonth() + 1).padStart(2, '0');
//        const dd = String(startDate.getDate()).padStart(2, '0');
//        const startStr = `${yyyy}-${mm}-${dd}`;
//        
//        const endStr = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
//        
//        window.location.href = `/activities?start=${startStr}&end=${endStr}`;
//    }
//}

</script>

</body>
</html>
